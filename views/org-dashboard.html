<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pandemic Response - Org Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="/css/firstPage.css" />
    <link rel="stylesheet" href="/css/sidebar.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        background: #f4f7fa;
        margin: 0;
        padding: 0;
      }

      .main-content {
        padding: 20px;
        margin-left: 250px;
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #2563eb;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .nav-link {
        color: #fff;
        text-decoration: none;
        font-size: 1.2rem;
        padding: 10px;
        transition: color 0.3s ease;
      }

      .nav-link:hover,
      .nav-link.active {
        color: #dbeafe;
      }

      .volunteer-btn {
        background: #22c55e;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease, transform 0.2s ease;
      }

      .volunteer-btn:hover {
        background: #16a34a;
        transform: scale(1.05);
      }

      .notification-bell {
        position: relative;
        cursor: pointer;
        color: #fff;
        font-size: 1.5rem;
        margin-left: 20px;
      }

      .notification-bell span {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #ef4444;
        color: #fff;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 0.8rem;
      }

      .notification-dropdown {
        position: absolute;
        top: 60px;
        right: 20px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        width: 300px;
        max-height: 400px;
        overflow-y: auto;
        display: none;
      }

      .notification-dropdown p {
        padding: 10px;
        margin: 0;
        border-bottom: 1px solid #d1d5db;
      }

      .dashboard-section {
        margin: 30px 0;
      }

      .dashboard-section h2 {
        font-size: 2rem;
        color: #1e40af;
        margin-bottom: 20px;
        text-align: center;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .dashboard-card {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        text-align: center;
        transition: transform 0.3s ease;
      }

      .dashboard-card:hover {
        transform: translateY(-5px);
      }

      .dashboard-card h3 {
        font-size: 1.5rem;
        color: #2563eb;
        margin: 0 0 10px;
      }

      .dashboard-card p {
        font-size: 2rem;
        color: #333;
        margin: 0;
      }

      .volunteer-list,
      .event-list,
      .task-list,
      .resource-list,
      .stories {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .volunteer-card,
      .event-card,
      .task-card,
      .resource-card,
      .story-card {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease;
      }

      .volunteer-card:hover,
      .event-card:hover,
      .task-card:hover,
      .resource-card:hover,
      .story-card:hover {
        transform: translateY(-5px);
      }

      .volunteer-card h3,
      .event-card h3,
      .task-card h3,
      .resource-card h3,
      .story-card h3 {
        font-size: 1.5rem;
        color: #1e40af;
        margin: 0 0 10px;
      }

      .volunteer-card p,
      .event-card p,
      .task-card p,
      .resource-card p,
      .story-card p {
        font-size: 1rem;
        color: #666;
        margin: 5px 0;
      }

      .badges {
        color: #f59e0b;
      }

      .add-btn,
      .export-btn {
        background: #2563eb;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        margin-bottom: 20px;
        transition: background 0.3s ease;
      }

      .add-btn:hover,
      .export-btn:hover {
        background: #1e40af;
      }

      #volunteer-chart,
      #event-calendar {
        max-width: 900px;
        margin: 20px auto;
      }

      .spotlight {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        text-align: center;
        margin: 20px 0;
      }

      .spotlight img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
      }

      .suggestions {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        margin: 20px 0;
      }

      #org-profile-form {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .input-group {
        margin: 15px 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .input-group i {
        font-size: 1.2rem;
        color: #2563eb;
      }

      .input-group input,
      .input-group textarea,
      .input-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .input-group input:focus,
      .input-group textarea:focus,
      .input-group select:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 5px rgba(37, 99, 235, 0.3);
      }

      .submit-btn {
        background: #2563eb;
        color: #fff;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease;
      }

      .submit-btn:hover {
        background: #1e40af;
      }

      .footer {
        text-align: center;
        padding: 20px;
        background: #2563eb;
        color: #fff;
        margin-top: 40px;
        border-radius: 10px 10px 0 0;
      }

      .footer-links a {
        color: #dbeafe;
        margin: 0 15px;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .footer-links a:hover {
        color: #fff;
      }

      @media (max-width: 768px) {
        .main-content {
          margin-left: 0;
          padding: 15px;
        }
        .navbar {
          flex-direction: column;
          gap: 10px;
        }
        .dashboard-grid,
        .volunteer-list,
        .event-list,
        .task-list,
        .resource-list,
        .stories {
          grid-template-columns: 1fr;
        }
        .notification-dropdown {
          width: 100%;
          right: 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="logo" onclick="window.location.href='/'">
      <img
        src="/images/logo.png"
        alt="Pandemic Response Logo"
        class="logo-img"
      />
    </div>
    <div class="sidebar" id="sidebar">
      <div class="sidebar-links">
        <a href="/" class="sidebar-link"
          ><i class="fa-solid fa-home"></i> Home</a
        >
        <a href="/firstPage" class="sidebar-link"
          ><i class="fa-solid fa-virus"></i> Dashboard</a
        >
        <a href="/pandamic" class="sidebar-link"
          ><i class="fa-solid fa-virus"></i> Live Pandemic Stats</a
        >
        <a href="/request" class="sidebar-link"
          ><i class="fa-solid fa-box-open"></i> Need Resources</a
        >
        <a href="/map" class="sidebar-link"
          ><i class="fa-solid fa-hospital"></i> Find Hospitals</a
        >
        <a href="/stats" class="sidebar-link"
          ><i class="fa-solid fa-chart-pie"></i> Graph Analytics</a
        >
        <a href="/organizations" class="sidebar-link"
          ><i class="fa-solid fa-building"></i> Organizations</a
        >
        <a href="/org-dashboard" class="sidebar-link"
          ><i class="fa-solid fa-tachometer-alt"></i> Org Dashboard</a
        >
        <a href="/user-dashboard" class="sidebar-link"
          ><i class="fa-solid fa-user"></i> User Dashboard</a
        >
        <a href="/alerts" class="sidebar-link"
          ><i class="fa-solid fa-bell"></i> Alerts</a
        >
        <a href="/profile" class="sidebar-link"
          ><i class="fa-solid fa-id-card"></i> Profile</a
        >
      </div>
      <div class="user-profile">
        <img
          src="/images/logohaire.png"
          alt="User Photo"
          id="user-photo"
          class="user-photo"
          onclick="toggleSidebarMobile()"
        />
        <div class="user-info">
          <span id="user-name">User Name</span>
        </div>
        <button class="profile-btn" onclick="window.location.href='/profile'">
          <i class="fa-solid fa-arrow-right"></i>
        </button>
      </div>
    </div>
    <div class="mobile-toggle" onclick="toggleSidebarMobile()">
      <i class="fa-solid fa-bars mobile-hamburger"></i>
    </div>

    <!-- Main Content -->
    <main class="main-content">
      <nav class="navbar">
        <div>
          <a href="#overview" class="nav-link active">Overview</a>
          <a href="#volunteers" class="nav-link">Volunteers</a>
          <a href="#events" class="nav-link">Events</a>
          <a href="#tasks" class="nav-link">Tasks</a>
          <a href="#resources" class="nav-link">Resources</a>
          <a href="#profile" class="nav-link">Profile</a>
        </div>
        <div style="display: flex; align-items: center">
          <button class="volunteer-btn" onclick="openVolunteerModal()">
            <i class="fa-solid fa-handshake-angle"></i> Become a Volunteer
          </button>
          <div class="notification-bell" onclick="toggleNotifications()">
            <i class="fa-solid fa-bell"></i>
            <span id="notification-count">0</span>
          </div>
        </div>
        <div class="notification-dropdown" id="notification-dropdown"></div>
      </nav>

      <section id="overview" class="dashboard-section">
        <h2><i class="fa-solid fa-chart-bar"></i> Organization Overview</h2>
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <h3>Volunteers</h3>
            <p id="volunteer-count">0</p>
          </div>
          <div class="dashboard-card">
            <h3>Projects</h3>
            <p id="project-count">0</p>
          </div>
          <div class="dashboard-card">
            <h3>Beneficiaries</h3>
            <p id="beneficiary-count">0</p>
          </div>
          <div class="dashboard-card">
            <h3>Hours Volunteered</h3>
            <p id="hours-volunteered">0</p>
          </div>
        </div>
      </section>

      <section id="volunteers" class="dashboard-section">
        <h2><i class="fa-solid fa-users"></i> Volunteer Management</h2>
        <button class="export-btn" onclick="exportData('volunteers')">
          <i class="fa-solid fa-download"></i> Export Volunteers
        </button>
        <canvas id="volunteer-chart"></canvas>
        <div class="spotlight">
          <h3>Volunteer of the Month</h3>
          <img src="" id="spotlight-photo" alt="Volunteer Photo" />
          <p id="spotlight-name"></p>
          <p id="spotlight-bio"></p>
        </div>
        <div class="volunteer-list" id="volunteer-list"></div>
        <div class="suggestions">
          <h3><i class="fa-solid fa-lightbulb"></i> Suggestions</h3>
          <p id="suggestion-text">Loading AI suggestions...</p>
        </div>
      </section>

      <section id="events" class="dashboard-section">
        <h2>
          <i class="fa-solid fa-calendar-alt"></i> Event & Fundraiser Management
        </h2>
        <button class="add-btn" onclick="openEventModal()">
          <i class="fa-solid fa-plus"></i> Add Event
        </button>
        <button class="export-btn" onclick="exportData('events')">
          <i class="fa-solid fa-download"></i> Export Events
        </button>
        <div id="event-calendar"></div>
        <div class="event-list" id="event-list"></div>
      </section>

      <section id="tasks" class="dashboard-section">
        <h2><i class="fa-solid fa-tasks"></i> Task Management</h2>
        <button class="add-btn" onclick="openTaskModal()">
          <i class="fa-solid fa-plus"></i> Add Task
        </button>
        <div class="task-list" id="task-list"></div>
      </section>

      <section id="resources" class="dashboard-section">
        <h2><i class="fa-solid fa-box-open"></i> Resource Tracker</h2>
        <div class="resource-list" id="resource-list"></div>
      </section>

      <section id="profile" class="dashboard-section">
        <h2><i class="fa-solid fa-building"></i> Organization Profile</h2>
        <form id="org-profile-form">
          <div class="input-group">
            <i class="fa-solid fa-image"></i>
            <input type="file" id="org-cover" accept="image/*" />
          </div>
          <div class="input-group">
            <i class="fa-solid fa-camera"></i>
            <input type="file" id="org-logo" accept="image/*" />
          </div>
          <div class="input-group">
            <i class="fa-solid fa-file-alt"></i>
            <textarea id="org-bio" placeholder="Description"></textarea>
          </div>
          <button type="submit" class="submit-btn">Update Profile</button>
        </form>
        <div class="stories" id="stories"></div>
      </section>

      <!-- Event Modal -->
      <div class="modal" id="event-modal">
        <div class="modal-content">
          <span class="modal-close" onclick="closeEventModal()">×</span>
          <h2><i class="fa-solid fa-calendar-alt"></i> Add Event</h2>
          <form id="event-form">
            <div class="input-group">
              <i class="fa-solid fa-calendar"></i>
              <input
                type="text"
                id="event-name"
                placeholder="Event Name"
                required
              />
            </div>
            <div class="input-group">
              <i class="fa-solid fa-align-left"></i>
              <textarea
                id="event-description"
                placeholder="Description"
                required
              ></textarea>
            </div>
            <div class="input-group">
              <i class="fa-solid fa-clock"></i>
              <input type="datetime-local" id="event-date" required />
            </div>
            <button type="submit" class="submit-btn">Create Event</button>
          </form>
        </div>
      </div>

      <!-- Task Modal -->
      <div class="modal" id="task-modal">
        <div class="modal-content">
          <span class="modal-close" onclick="closeTaskModal()">×</span>
          <h2><i class="fa-solid fa-tasks"></i> Add Task</h2>
          <form id="task-form">
            <div class="input-group">
              <i class="fa-solid fa-user"></i>
              <select id="task-volunteer" required></select>
            </div>
            <div class="input-group">
              <i class="fa-solid fa-align-left"></i>
              <textarea
                id="task-description"
                placeholder="Task Description"
                required
              ></textarea>
            </div>
            <button type="submit" class="submit-btn">Assign Task</button>
          </form>
        </div>
      </div>

      <!-- Volunteer Modal -->
      <div class="modal" id="volunteer-modal">
        <div class="modal-content">
          <span class="modal-close" onclick="closeVolunteerModal()">×</span>
          <h2>
            <i class="fa-solid fa-handshake-angle"></i> Become a Volunteer
          </h2>
          <div class="volunteer-tabs">
            <button class="tab-btn active" onclick="showTab('individual')">
              Individual
            </button>
            <button class="tab-btn" onclick="showTab('create-org')">
              Create Org
            </button>
            <button class="tab-btn" onclick="showTab('join-org')">
              Join Org
            </button>
          </div>
          <div class="progress-bar">
            <div class="progress" id="progress"></div>
          </div>

          <form id="individual-form" class="volunteer-form active">
            <div class="form-step" data-step="1">
              <div class="input-group">
                <i class="fa-solid fa-user"></i>
                <input
                  type="text"
                  id="ind-name"
                  placeholder="Full Name"
                  required
                />
              </div>
              <div class="input-group">
                <i class="fa-solid fa-envelope"></i>
                <input
                  type="email"
                  id="ind-email"
                  placeholder="Email"
                  required
                />
              </div>
              <button
                type="button"
                class="next-btn"
                onclick="nextStep('individual', 2)"
              >
                Next
              </button>
            </div>
            <div class="form-step hidden" data-step="2">
              <div class="input-group">
                <i class="fa-solid fa-phone"></i>
                <select id="ind-country-code" required>
                  <option value="+1">+1 (US)</option>
                  <option value="+91">+91 (IN)</option>
                  <option value="+44">+44 (UK)</option>
                </select>
                <input
                  type="tel"
                  id="ind-phone"
                  placeholder="Phone Number"
                  required
                />
              </div>
              <div class="input-group">
                <i class="fa-solid fa-briefcase"></i>
                <input
                  type="text"
                  id="ind-skills"
                  placeholder="Skills (e.g., Medical, Logistics)"
                  required
                />
              </div>
              <button
                type="button"
                class="prev-btn"
                onclick="prevStep('individual', 1)"
              >
                Previous
              </button>
              <button type="submit" class="submit-btn">Submit</button>
            </div>
          </form>

          <form id="create-org-form" class="volunteer-form hidden">
            <div class="form-step" data-step="1">
              <div class="input-group">
                <i class="fa-solid fa-building"></i>
                <input
                  type="text"
                  id="org-name"
                  placeholder="Organization Name"
                  required
                />
              </div>
              <div class="input-group">
                <i class="fa-solid fa-envelope"></i>
                <input
                  type="email"
                  id="org-email"
                  placeholder="Contact Email"
                  required
                />
              </div>
              <button
                type="button"
                class="next-btn"
                onclick="nextStep('create-org', 2)"
              >
                Next
              </button>
            </div>
            <div class="form-step hidden" data-step="2">
              <div class="input-group">
                <i class="fa-solid fa-map-marker-alt"></i>
                <input
                  type="text"
                  id="org-location"
                  placeholder="Location"
                  required
                />
              </div>
              <div class="input-group">
                <i class="fa-solid fa-file-alt"></i>
                <textarea
                  id="org-description"
                  placeholder="Description"
                  required
                ></textarea>
              </div>
              <button
                type="button"
                class="prev-btn"
                onclick="prevStep('create-org', 1)"
              >
                Previous
              </button>
              <button type="submit" class="submit-btn">Submit</button>
            </div>
          </form>

          <form id="join-org-form" class="volunteer-form hidden">
            <div class="form-step" data-step="1">
              <div class="input-group">
                <i class="fa-solid fa-search"></i>
                <input
                  type="text"
                  id="org-search"
                  placeholder="Search Organizations"
                />
              </div>
              <div class="org-list" id="org-list"></div>
              <button
                type="button"
                class="next-btn"
                onclick="nextStep('join-org', 2)"
              >
                Next
              </button>
            </div>
            <div class="form-step hidden" data-step="2">
              <div class="input-group">
                <i class="fa-solid fa-user"></i>
                <input
                  type="text"
                  id="join-name"
                  placeholder="Your Full Name"
                  required
                />
              </div>
              <div class="input-group">
                <i class="fa-solid fa-envelope"></i>
                <input
                  type="email"
                  id="join-email"
                  placeholder="Your Email"
                  required
                />
              </div>
              <button
                type="button"
                class="prev-btn"
                onclick="prevStep('join-org', 1)"
              >
                Previous
              </button>
              <button type="submit" class="submit-btn">Join</button>
            </div>
          </form>
        </div>
      </div>

      <footer class="footer">
        <p>© 2025 Pandemic Response. All Rights Reserved.</p>
        <div class="footer-links">
          <a href="/privacy"><i class="fa-solid fa-lock"></i> Privacy Policy</a>
          <a href="/terms"
            ><i class="fa-solid fa-file-contract"></i> Terms of Service</a
          >
          <a href="/contact"><i class="fa-solid fa-envelope"></i> Contact Us</a>
        </div>
      </footer>
    </main>
    <div class="grey"></div>
    <div class="popup" id="popup">
      <span class="popup-text" id="popup-text"></span>
      <button class="close-popup" id="close-popup">Close</button>
    </div>

    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="/js/sidebar.js"></script>
    <script>
      // Popup Functions
      const popup = document.getElementById("popup");
      const popupText = document.getElementById("popup-text");
      const closePopupButton = document.getElementById("close-popup");

      closePopupButton.addEventListener(
        "click",
        () => (popup.style.display = "none")
      );

      function showPopupMessage(message) {
        popupText.textContent = message;
        popup.style.display = "flex";
        setTimeout(() => (popup.style.display = "none"), 3000);
      }

      // Volunteer Modal Functions
      function openVolunteerModal() {
        document.getElementById("volunteer-modal").style.display = "flex";
        showTab("individual");
        fetchOrganizationsForJoin();
      }

      function closeVolunteerModal() {
        document.getElementById("volunteer-modal").style.display = "none";
        resetForms();
      }

      function showTab(tabId) {
        const tabs = document.querySelectorAll(".tab-btn");
        const forms = document.querySelectorAll(".volunteer-form");
        tabs.forEach((btn) => btn.classList.remove("active"));
        forms.forEach((form) => form.classList.remove("active"));
        document
          .querySelector(`[onclick="showTab('${tabId}')"]`)
          .classList.add("active");
        document.getElementById(`${tabId}-form`).classList.add("active");
        updateProgress(tabId, 1);
      }

      function updateProgress(formId, step) {
        document.getElementById("progress").style.width =
          step === 1 ? "50%" : "100%";
      }

      function nextStep(formId, step) {
        const currentStep = document.querySelector(
          `#${formId}-form .form-step[data-step="${step - 1}"]`
        );
        const nextStep = document.querySelector(
          `#${formId}-form .form-step[data-step="${step}"]`
        );
        currentStep.classList.add("hidden");
        nextStep.classList.remove("hidden");
        updateProgress(formId, step);
      }

      function prevStep(formId, step) {
        const currentStep = document.querySelector(
          `#${formId}-form .form-step[data-step="${step + 1}"]`
        );
        const prevStep = document.querySelector(
          `#${formId}-form .form-step[data-step="${step}"]`
        );
        currentStep.classList.add("hidden");
        prevStep.classList.remove("hidden");
        updateProgress(formId, step);
      }

      function resetForms() {
        document.querySelectorAll(".volunteer-form").forEach((form) => {
          form.reset();
          form
            .querySelectorAll(".form-step")
            .forEach((step) => step.classList.add("hidden"));
          form
            .querySelector(".form-step[data-step='1']")
            .classList.remove("hidden");
        });
        updateProgress("individual", 1);
      }

      // Event Modal Functions
      function openEventModal() {
        document.getElementById("event-modal").style.display = "flex";
      }

      function closeEventModal() {
        document.getElementById("event-modal").style.display = "none";
        document.getElementById("event-form").reset();
      }

      // Task Modal Functions
      function openTaskModal() {
        document.getElementById("task-modal").style.display = "flex";
        populateTaskVolunteers();
      }

      function closeTaskModal() {
        document.getElementById("task-modal").style.display = "none";
        document.getElementById("task-form").reset();
      }

      // Notification Functions
      function toggleNotifications() {
        const dropdown = document.getElementById("notification-dropdown");
        dropdown.style.display =
          dropdown.style.display === "block" ? "none" : "block";
      }

      // Fetch Overview Data
      async function fetchOverview() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/org/overview",
            {
              headers: { Authorization: localStorage.getItem("token") },
            }
          );
          const data = await response.json();
          document.getElementById("volunteer-count").textContent =
            data.volunteers || 0;
          document.getElementById("project-count").textContent =
            data.projects || 0;
          document.getElementById("beneficiary-count").textContent =
            data.beneficiaries || 0;
          document.getElementById("hours-volunteered").textContent =
            data.hoursVolunteered || 0;
        } catch (error) {
          console.error("Error fetching overview:", error);
          showPopupMessage("Failed to load overview data.");
        }
      }

      // Fetch Volunteers and Chart
      async function fetchVolunteers() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/org/volunteers",
            {
              headers: { Authorization: localStorage.getItem("token") },
            }
          );
          const volunteers = await response.json();
          const volunteerList = document.getElementById("volunteer-list");
          volunteerList.innerHTML = "";
          volunteers.forEach((volunteer) => {
            const card = document.createElement("div");
            card.className = "volunteer-card";
            card.innerHTML = `
              <h3>${volunteer.name}</h3>
              <p><i class="fa-solid fa-envelope"></i> ${volunteer.email}</p>
              <p><i class="fa-solid fa-briefcase"></i> ${
                volunteer.skills || "N/A"
              }</p>
              <p><i class="fa-solid fa-trophy"></i> Badges: <span class="badges">${
                volunteer.badges || "None"
              }</span></p>
            `;
            volunteerList.appendChild(card);
          });

          // Volunteer Chart
          const skillCounts = volunteers.reduce((acc, v) => {
            acc[v.skills || "Other"] = (acc[v.skills || "Other"] || 0) + 1;
            return acc;
          }, {});
          const ctx = document
            .getElementById("volunteer-chart")
            .getContext("2d");
          new Chart(ctx, {
            type: "bar",
            data: {
              labels: Object.keys(skillCounts),
              datasets: [
                {
                  label: "Volunteers by Skill",
                  data: Object.values(skillCounts),
                  backgroundColor: "#2563eb",
                },
              ],
            },
            options: { scales: { y: { beginAtZero: true } } },
          });

          // Spotlight (assuming first volunteer as example)
          if (volunteers.length > 0) {
            document.getElementById("spotlight-photo").src =
              volunteers[0].photo || "/images/default-photo.png";
            document.getElementById("spotlight-name").textContent =
              volunteers[0].name;
            document.getElementById("spotlight-bio").textContent =
              volunteers[0].bio || "A dedicated volunteer!";
          }

          ScrollReveal().reveal(".volunteer-card", {
            delay: 200,
            distance: "50px",
            origin: "bottom",
            interval: 100,
          });
        } catch (error) {
          console.error("Error fetching volunteers:", error);
          showPopupMessage("Failed to load volunteers.");
        }
      }

      // Fetch Events and Calendar
      async function fetchEvents() {
        try {
          const response = await fetch("http://localhost:5000/api/org/events", {
            headers: { Authorization: localStorage.getItem("token") },
          });
          const events = await response.json();
          const eventList = document.getElementById("event-list");
          eventList.innerHTML = "";
          events.forEach((event) => {
            const card = document.createElement("div");
            card.className = "event-card";
            card.innerHTML = `
              <h3>${event.name}</h3>
              <p><i class="fa-solid fa-align-left"></i> ${event.description.slice(
                0,
                100
              )}...</p>
              <p><i class="fa-solid fa-clock"></i> ${new Date(
                event.date
              ).toLocaleString()}</p>
            `;
            eventList.appendChild(card);
          });

          // Event Calendar
          const calendarEl = document.getElementById("event-calendar");
          const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: "dayGridMonth",
            events: events.map((e) => ({ title: e.name, start: e.date })),
          });
          calendar.render();

          ScrollReveal().reveal(".event-card", {
            delay: 200,
            distance: "50px",
            origin: "bottom",
            interval: 100,
          });
        } catch (error) {
          console.error("Error fetching events:", error);
          showPopupMessage("Failed to load events.");
        }
      }

      // Fetch Tasks
      async function fetchTasks() {
        try {
          const response = await fetch("http://localhost:5000/api/org/tasks", {
            headers: { Authorization: localStorage.getItem("token") },
          });
          const tasks = await response.json();
          const taskList = document.getElementById("task-list");
          taskList.innerHTML = "";
          tasks.forEach((task) => {
            const card = document.createElement("div");
            card.className = "task-card";
            card.innerHTML = `
              <h3>${task.volunteerName}</h3>
              <p><i class="fa-solid fa-align-left"></i> ${task.description}</p>
            `;
            taskList.appendChild(card);
          });
          ScrollReveal().reveal(".task-card", {
            delay: 200,
            distance: "50px",
            origin: "bottom",
            interval: 100,
          });
        } catch (error) {
          console.error("Error fetching tasks:", error);
          showPopupMessage("Failed to load tasks.");
        }
      }

      // Fetch Resources
      async function fetchResources() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/org/resources",
            {
              headers: { Authorization: localStorage.getItem("token") },
            }
          );
          const resources = await response.json();
          const resourceList = document.getElementById("resource-list");
          resourceList.innerHTML = "";
          resources.forEach((resource) => {
            const card = document.createElement("div");
            card.className = "resource-card";
            card.innerHTML = `
              <h3>${resource.name}</h3>
              <p><i class="fa-solid fa-box"></i> Quantity: ${resource.quantity}</p>
            `;
            resourceList.appendChild(card);
          });
          ScrollReveal().reveal(".resource-card", {
            delay: 200,
            distance: "50px",
            origin: "bottom",
            interval: 100,
          });
        } catch (error) {
          console.error("Error fetching resources:", error);
          showPopupMessage("Failed to load resources.");
        }
      }

      // Fetch Profile and Stories
      async function fetchProfile() {
  try {
    const token = localStorage.getItem("token");
    if (!token) {
      console.error("No token found in localStorage");
      showPopupMessage("Please log in to access this page.");
      window.location.href = "/login"; // Redirect to login if no token
      return;
    }

    const response = await fetch("http://localhost:5000/api/org/profile", {
      headers: { Authorization: `Bearer ${token}` }, // Ensure Bearer prefix
    });

    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    const profile = await response.json();
    document.getElementById("org-bio").value = profile.bio || "";
    const storiesContainer = document.getElementById("stories");
    storiesContainer.innerHTML = "";
    (profile.stories || []).forEach((story) => {
      const card = document.createElement("div");
      card.className = "story-card";
      card.innerHTML = `<p>${story}</p>`;
      storiesContainer.appendChild(card);
    });
    ScrollReveal().reveal(".story-card", { delay: 200, distance: "50px", origin: "bottom", interval: 100 });
  } catch (error) {
    console.error("Error fetching profile:", error);
    showPopupMessage("Failed to load profile. Please log in again.");
  }
}

      // Submit Event
      document
        .getElementById("event-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const data = {
            name: document.getElementById("event-name").value,
            description: document.getElementById("event-description").value,
            date: document.getElementById("event-date").value,
          };
          try {
            const response = await fetch(
              "http://localhost:5000/api/org/events",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: localStorage.getItem("token"),
                },
                body: JSON.stringify(data),
              }
            );
            if (!response.ok) throw new Error("Failed to create event");
            showPopupMessage("Event created successfully!");
            closeEventModal();
            fetchEvents();
          } catch (error) {
            console.error("Error creating event:", error);
            showPopupMessage("Failed to create event.");
          }
        });

      // Submit Task
      document
        .getElementById("task-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const data = {
            volunteerId: document.getElementById("task-volunteer").value,
            description: document.getElementById("task-description").value,
          };
          try {
            const response = await fetch(
              "http://localhost:5000/api/org/tasks",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: localStorage.getItem("token"),
                },
                body: JSON.stringify(data),
              }
            );
            if (!response.ok) throw new Error("Failed to assign task");
            showPopupMessage("Task assigned successfully!");
            closeTaskModal();
            fetchTasks();
          } catch (error) {
            console.error("Error assigning task:", error);
            showPopupMessage("Failed to assign task.");
          }
        });

      // Submit Profile
      document
        .getElementById("org-profile-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData();
          formData.append(
            "cover",
            document.getElementById("org-cover").files[0]
          );
          formData.append("logo", document.getElementById("org-logo").files[0]);
          formData.append("bio", document.getElementById("org-bio").value);
          try {
            const response = await fetch(
              "http://localhost:5000/api/org/profile",
              {
                method: "POST",
                headers: { Authorization: localStorage.getItem("token") },
                body: formData,
              }
            );
            if (!response.ok) throw new Error("Failed to update profile");
            showPopupMessage("Profile updated successfully!");
            fetchProfile();
          } catch (error) {
            console.error("Error updating profile:", error);
            showPopupMessage("Failed to update profile.");
          }
        });

      // Fetch Organizations for Join Modal
      async function fetchOrganizationsForJoin() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/organizations"
          );
          const orgs = await response.json();
          const orgList = document.getElementById("org-list");
          orgList.innerHTML = "";
          orgs.forEach((org) => {
            const div = document.createElement("div");
            div.className = "org-item";
            div.textContent = `${org.name} (${org.location})`;
            div.dataset.orgId = org._id;
            div.onclick = () => {
              document
                .querySelectorAll(".org-item")
                .forEach((item) => item.classList.remove("selected"));
              div.classList.add("selected");
            };
            orgList.appendChild(div);
          });
        } catch (error) {
          console.error("Error fetching organizations:", error);
          showPopupMessage("Failed to load organizations.");
        }
      }

      // Populate Task Volunteers
      async function populateTaskVolunteers() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/org/volunteers",
            {
              headers: { Authorization: localStorage.getItem("token") },
            }
          );
          const volunteers = await response.json();
          const select = document.getElementById("task-volunteer");
          select.innerHTML = '<option value="">Select Volunteer</option>';
          volunteers.forEach((volunteer) => {
            const option = document.createElement("option");
            option.value = volunteer._id;
            option.textContent = volunteer.name;
            select.appendChild(option);
          });
        } catch (error) {
          console.error("Error fetching volunteers for task:", error);
          showPopupMessage("Failed to load volunteers for task assignment.");
        }
      }

      // Submit Volunteer Form
      async function submitVolunteer(data) {
        try {
          const response = await fetch(
            "http://localhost:5000/api/volunteer/signup",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: localStorage.getItem("token"),
              },
              body: JSON.stringify(data),
            }
          );
          if (!response.ok) throw new Error("Failed to submit volunteer data");
          showPopupMessage("Volunteer signup successful!");
          closeVolunteerModal();
        } catch (error) {
          console.error("Error submitting volunteer data:", error);
          showPopupMessage("Error during signup.");
        }
      }

      // Export Data (Placeholder)
      function exportData(type) {
        showPopupMessage(
          `Exporting ${type} data... (Feature under development)`
        );
        // Implement CSV/PDF export logic here
      }

      // Simulate WebSocket Notifications
      function simulateNotifications() {
        setInterval(() => {
          const count =
            parseInt(
              document.getElementById("notification-count").textContent
            ) + 1;
          document.getElementById("notification-count").textContent = count;
          const dropdown = document.getElementById("notification-dropdown");
          dropdown.innerHTML += `<p>New volunteer signed up!</p>`;
        }, 10000); // Every 10 seconds for demo
      }

      // AI Suggestions (Placeholder)
      function fetchSuggestions() {
        // Simulate AI suggestion
        setTimeout(() => {
          document.getElementById("suggestion-text").textContent =
            "Assign a logistics task to a volunteer with relevant skills.";
        }, 2000);
      }

      // Event Listeners
      document.addEventListener("DOMContentLoaded", () => {
        fetchOverview();
        fetchVolunteers();
        fetchEvents();
        fetchTasks();
        fetchResources();
        fetchProfile();
        simulateNotifications();
        fetchSuggestions();

        document
          .getElementById("individual-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            const data = {
              name: document.getElementById("ind-name").value,
              email: document.getElementById("ind-email").value,
              phone: `${document.getElementById("ind-country-code").value}${
                document.getElementById("ind-phone").value
              }`,
              skills: document.getElementById("ind-skills").value,
              type: "individual",
            };
            await submitVolunteer(data);
          });

        document
          .getElementById("create-org-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            const data = {
              name: document.getElementById("org-name").value,
              email: document.getElementById("org-email").value,
              location: document.getElementById("org-location").value,
              description: document.getElementById("org-description").value,
              type: "create-org",
            };
            await submitVolunteer(data);
          });

        document
          .getElementById("join-org-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            const selectedOrg = document.querySelector(".org-item.selected");
            if (!selectedOrg) {
              showPopupMessage("Please select an organization.");
              return;
            }
            const data = {
              name: document.getElementById("join-name").value,
              email: document.getElementById("join-email").value,
              orgId: selectedOrg.dataset.orgId,
              type: "join-org",
            };
            await submitVolunteer(data);
          });

        // Navbar Active State
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.addEventListener("click", () => {
            document
              .querySelectorAll(".nav-link")
              .forEach((l) => l.classList.remove("active"));
            link.classList.add("active");
          });
        });
      });
    </script>
  </body>
</html>
